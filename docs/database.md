# Database

## Set up

The project needs to be able to access a PostgreSQL database named `no-manga`

```(commandLine)
(assumes you have PostgreSQL, psql CLI tool installed)
$ dropdb no-manga
$ createdb no-manga
$ psql -d no-manga
$ \i path-to-database/setup.sql
$ \i path-to-database/seed.sql
$ \q
(to quit psql)
```

There is a table diagram in `tableDiagram.png`, which is also shown at <https://dbdiagram.io/d/5fe996aa9a6c525a03bc7393> (although the remote diagram needs to be kept in sync manually)

## Design

To be written and git fixed-up into this file

## Mocks

`database/seed.sql` has some real data in it, written by hand. `mockData` has synthetic data created by <https://www.mockaroo.com/> and edited by hand (to change the `[]`s to `ARRAY[]`s and format it as single giant insert instead of N individual inserts), and created by the truly hideous JS scripts in `mockData/index.js`.

Without pagination and other controls, the mockaroo data alone is enough to utterly crush the api, which is why most of it is commented out. The SQL files generated by the JS scripts can be hand-tuned to generate less data.

### Mockaroo

Mockaroo was used for the tables with complicated data requirements, but that didn't require anything mockaroo can't generate a realistic distribution for (like relationships).

- magazine

  - name companyName 0%
  - other_names number 1 - 4 0 20%

  ```ruby
    -- if this == 1 then [name + /-\d{3}/.gen]
    -- elsif this == 2 then [name + /-\d{3}/.gen, name + /-\d{3}/.gen]
    -- elsif this == 3 then [name + /-\d{3}/.gen,  name + /-\d{3}/.gen,  name + /-\d{3}/.gen]
    -- elsif this == 4 then [name + /-\d{3}/.gen,  name + /-\d{3}/.gen,  name + /-\d{3}/.gen,  name + /-\d{3}/.gen]
    -- end
  ```

  - description words 4 - 20 0%
  - demo number 1 - 7 0 0%

  ```ruby
    if this == 1 then 'josei'
    elsif this == 2 then 'kodomo'
    elsif this == 3 then 'mina'
    elsif this == 4 then 'seijin'
    elsif this == 5 then 'seinen'
    elsif this == 6 then 'shojo'
    elsif this == 7 then 'shonen'
    end
  ```

- manga

  - name animalCommonName 0%
  - other_names number 1 - 3 0 60%

  ```ruby
    if this == 1 then [name + /-\d{3}/.gen]
    elsif this == 2 then [name + /-\d{3}/.gen, name + /-\d{3}/.gen]
    elsif this == 3 then [name + /-\d{3}/.gen,  name + /-\d{3}/.gen,  name + /-\d{3}/.gen]
    end
  ```

  - description words 4 - 20 0%
  - demo number 1 - 7 0 0%

  ```ruby
    if this == 1 then 'josei'
    elsif this == 2 then 'kodomo'
    elsif this == 3 then 'mina'
    elsif this == 4 then 'seijin'
    elsif this == 5 then 'seinen'
    elsif this == 6 then 'shojo'
    elsif this == 7 then 'shonen'
    end
  ```

  - start_date 01/01/1945 - present mm/dd/yyyy 0%
  - end_date formula 20%

  ```ruby
    now()
    - years(random(0, year(now()) - year(start_date)))
    - months(random(0, month(now()) - month(start_date)))
    - days(random(0, day(now()) - day(start_date)))
  ```

- mangaka

  - name fullName 0%
  - other_names number 1 - 3 0 60%

  ```ruby
    if this == 1 then [name + /-\d{3}/.gen]
    elsif this == 2 then [name + /-\d{3}/.gen, name + /-\d{3}/.gen]
    elsif this == 3 then [name + /-\d{3}/.gen,  name + /-\d{3}/.gen,  name + /-\d{3}/.gen]
    end
  ```

  - description words 4 - 20 0%

### Scripts

The JS script was used for the tables with simple data requirements that did require hand-tuned distributions (mostly relationships).

- chapter
- genre
- magazine_manga
- manga_genre
- manga_mangaka_job

### No mock data needed

Enum tables do not require any mock data.

- demo
- job
